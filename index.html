<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Sonido Interior - Descubre tu Personalidad Musical</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .jenga-block {
            width: 80px;
            height: 25px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
            display: inline-block;
            position: relative;
        }
        
        .jenga-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .jenga-block.selected {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            border-color: #fbbf24;
        }
        
        .color-negro { background-color: #000000; }
        .color-rojo { background-color: #dc2626; }
        .color-blanco { background-color: #ffffff; color: #000; }
        .color-amarillo { background-color: #fbbf24; color: #000; }
        .color-azul { background-color: #1e40af; }
        .color-verde { background-color: #16a34a; }
        
        .option-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #8b5cf6;
        }
        
        .option-card.selected {
            border-color: #fbbf24;
            background: rgba(251,191,36,0.1);
            transform: translateY(-3px);
        }
        
        .play-button {
            background: linear-gradient(45deg, #8b5cf6, #06b6d4);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(139,92,246,0.4);
        }
        
        .stop-button {
            background: linear-gradient(45deg, #ef4444, #f59e0b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .profile-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            border-top: 10px solid #fbbf24;
        }
        
        .profile-header {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .profile-section {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .profile-section:last-child {
            border-bottom: none;
        }
        
        .profile-title {
            color: #f59e0b;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .profile-title i {
            margin-right: 10px;
        }
        
        .profile-content {
            color: #4b5563;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .signature-item {
            text-align: center;
            font-size: 0.8rem;
            color: #6b7280;
        }
        
        .reveal-button {
            background: linear-gradient(45deg, #f59e0b, #ef4444);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245,158,11,0.4);
        }
        
        .reveal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245,158,11,0.6);
        }
        
        .reveal-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .jenga-tower {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .jenga-row {
            display: flex;
            margin: 1px 0;
        }
        
        .jenga-row:nth-child(even) {
            transform: rotate(90deg);
        }
        
        .progress-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .progress-step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .progress-step.active {
            background: #fbbf24;
            transform: scale(1.3);
        }
        
        .progress-step.completed {
            background: #10b981;
        }
        
        @media (max-width: 768px) {
            .jenga-block {
                width: 60px;
                height: 20px;
            }
            .option-card {
                padding: 15px;
                margin: 8px 0;
            }
            .signature-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                <i class="fas fa-music mr-4"></i>Tu Sonido Interior
            </h1>
            <p class="text-xl text-white opacity-90 mb-2">
                Descubre tu personalidad musical a través de la emoción, el ritmo y la vibración
            </p>
            <p class="text-lg text-white opacity-75">
                Juego Musical Terapéutico - Ideal para jornadas escolares, ferias y eventos de bienestar
            </p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-step" id="step1"></div>
            <div class="progress-step" id="step2"></div>
            <div class="progress-step" id="step3"></div>
            <div class="progress-step" id="step4"></div>
        </div>

        <!-- Step 1: Jenga Tower -->
        <div id="jengaSection" class="option-card text-center mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-cubes mr-2"></i>Paso 1: Selecciona tu Ficha Jenga
            </h2>
            <p class="text-gray-600 mb-6">Elige el color que más te represente en este momento</p>
            
            <div class="jenga-tower">
                <div class="jenga-row">
                    <div class="jenga-block color-negro" data-color="Negro" title="Negro"></div>
                    <div class="jenga-block color-rojo" data-color="Rojo" title="Rojo"></div>
                    <div class="jenga-block color-blanco" data-color="Blanco" title="Blanco"></div>
                </div>
                <div class="jenga-row">
                    <div class="jenga-block color-amarillo" data-color="Amarillo" title="Amarillo"></div>
                    <div class="jenga-block color-azul" data-color="Azul" title="Azul"></div>
                    <div class="jenga-block color-verde" data-color="Verde" title="Verde"></div>
                </div>
                <div class="jenga-row">
                    <div class="jenga-block color-negro" data-color="Negro" title="Negro"></div>
                    <div class="jenga-block color-rojo" data-color="Rojo" title="Rojo"></div>
                    <div class="jenga-block color-blanco" data-color="Blanco" title="Blanco"></div>
                </div>
                <div class="jenga-row">
                    <div class="jenga-block color-amarillo" data-color="Amarillo" title="Amarillo"></div>
                    <div class="jenga-block color-azul" data-color="Azul" title="Azul"></div>
                    <div class="jenga-block color-verde" data-color="Verde" title="Verde"></div>
                </div>
            </div>
            
            <div id="colorSelected" class="mt-4 text-lg font-semibold text-green-600 hidden">
                <i class="fas fa-check-circle mr-2"></i>Color seleccionado: <span id="selectedColorName"></span>
            </div>
        </div>

        <!-- Step 2: Melodies -->
        <div id="melodiesSection" class="hidden">
            <div class="option-card mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-music mr-2"></i>Paso 2: DURANTE 15 SEGUNDOS ¿Cuál melodía sientes más tuya?
                </h2>
                <p class="text-gray-600 mb-6">Escucha cada melodía HASTA DETENERSE y elige la que más resuene contigo</p>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="option-card melody-option" data-melody="Weightless">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">MELODÍA 1</h3>
                                <p class="text-gray-600 text-sm">Melodía relajante y envolvente</p>
                            </div>
                            <button class="play-button melody-play" onclick="playSound('melody', 'Weightless', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button melody-stop hidden" onclick="stopSound('melody', 'Weightless', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card melody-option" data-melody="Sonidos del bosque">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">MELODÍA 2</h3>
                                <p class="text-gray-600 text-sm">Conexión con la naturaleza</p>
                            </div>
                            <button class="play-button melody-play" onclick="playSound('melody', 'Sonidos del bosque', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button melody-stop hidden" onclick="stopSound('melody', 'Sonidos del bosque', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card melody-option" data-melody="Synfony">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">MELODÍA 3</h3>
                                <p class="text-gray-600 text-sm">Armonía clásica moderna</p>
                            </div>
                            <button class="play-button melody-play" onclick="playSound('melody', 'Synfony', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button melody-stop hidden" onclick="stopSound('melody', 'Synfony', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Botón para avanzar manualmente al paso 3 -->
                <div class="text-center mt-6">
                    <button onclick="goToStep(3)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-arrow-right mr-2"></i> Continuar al Paso 3
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 3: Rhythms -->
        <div id="rhythmsSection" class="hidden">
            <div class="option-card mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-drum mr-2"></i>Paso 3: ¿Cuál ritmo te mueve más?
                </h2>
                <p class="text-gray-600 mb-6">Siente cada ritmo y selecciona el que active tu energía</p>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="option-card rhythm-option" data-rhythm="Balada">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">RITMO 1</h3>
                                <p class="text-gray-600 text-sm">Suave y emotivo</p>
                            </div>
                            <button class="play-button rhythm-play" onclick="playSound('rhythm', 'Balada', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button rhythm-stop hidden" onclick="stopSound('rhythm', 'Balada', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card rhythm-option" data-rhythm="Despecho">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">RITMO 2</h3>
                                <p class="text-gray-600 text-sm">Intenso y apasionado</p>
                            </div>
                            <button class="play-button rhythm-play" onclick="playSound('rhythm', 'Despecho', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button rhythm-stop hidden" onclick="stopSound('rhythm', 'Despecho', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card rhythm-option" data-rhythm="Merengue">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">RITMO 3</h3>
                                <p class="text-gray-600 text-sm">Alegre y RUMBERO(A)</p>
                            </div>
                            <button class="play-button rhythm-play" onclick="playSound('rhythm', 'Merengue', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button rhythm-stop hidden" onclick="stopSound('rhythm', 'Merengue', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card rhythm-option" data-rhythm="Reguetón">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">RITMO 4</h3>
                                <p class="text-gray-600 text-sm">Urbano y enérgico</p>
                            </div>
                            <button class="play-button rhythm-play" onclick="playSound('rhythm', 'Reguetón', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button rhythm-stop hidden" onclick="stopSound('rhythm', 'Reguetón', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card rhythm-option" data-rhythm="Salsa">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">RITMO 5</h3>
                                <p class="text-gray-600 text-sm">Tropical y vibrante</p>
                            </div>
                            <button class="play-button rhythm-play" onclick="playSound('rhythm', 'Salsa', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button rhythm-stop hidden" onclick="stopSound('rhythm', 'Salsa', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Botón para avanzar manualmente al paso 4 -->
                <div class="text-center mt-6">
                    <button onclick="goToStep(4)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-arrow-right mr-2"></i> Continuar al Paso 4
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 4: Emotions -->
        <div id="emotionsSection" class="hidden">
            <div class="option-card mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-heart mr-2"></i>Paso 4: ¿Cuál emoción quieres expresar hoy?
                </h2>
                <p class="text-gray-600 mb-6">Conecta con tu estado emocional del momento</p>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="option-card emotion-option" data-emotion="Suspenso">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">EMOCIÓN 1</h3>
                                <p class="text-gray-600 text-sm">Misterioso(a)</p>
                            </div>
                            <button class="play-button emotion-play" onclick="playSound('emotion', 'Suspenso', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button emotion-stop hidden" onclick="stopSound('emotion', 'Suspenso', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card emotion-option" data-emotion="Tristeza">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">EMOCIÓN 2</h3>
                                <p class="text-gray-600 text-sm">Personalidad profunda y reflexiva</p>
                            </div>
                            <button class="play-button emotion-play" onclick="playSound('emotion', 'Tristeza', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button emotion-stop hidden" onclick="stopSound('emotion', 'Tristeza', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-card emotion-option" data-emotion="Alegría">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-lg">EMOCIÓN 3</h3>
                                <p class="text-gray-600 text-sm">Personalidad positiva y radiante</p>
                            </div>
                            <button class="play-button emotion-play" onclick="playSound('emotion', 'Alegría', this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="stop-button emotion-stop hidden" onclick="stopSound('emotion', 'Alegría', this)">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reveal Button -->
        <div id="revealSection" class="text-center mb-8 hidden">
            <button id="revealButton" class="reveal-button" disabled>
                <i class="fas fa-magic mr-2"></i>Revelar Mi Perfil Musical
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="profile-card fade-in">
                <div class="profile-header">
                    <h2 class="text-3xl font-bold mb-2" id="profileName">Amarillo - Perfil Único</h2>
                    <div class="flex justify-center space-x-4 mt-4">
                        <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">Synfony</span>
                        <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">Reguetón</span>
                        <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">Suspenso</span>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3 class="profile-title"><i class="fas fa-user"></i> Descripción de tu Perfil</h3>
                    <p class="profile-content" id="profileDescription">Tu combinación única de Amarillo, Synfony, Reguetón y Suspenso revela una personalidad musical especial y auténtica.</p>
                </div>
                
                <div class="profile-section">
                    <h3 class="profile-title"><i class="fas fa-guitar"></i> Instrumento Sugerido</h3>
                    <p class="profile-content" id="suggestedInstrument">Instrumento de percusión</p>
                </div>
                
                <div class="profile-section">
                    <h3 class="profile-title"><i class="fas fa-running"></i> Actividad Recomendada</h3>
                    <p class="profile-content" id="recommendedActivity">Explora diferentes ritmos y melodías para encontrar tu expresión personal</p>
                </div>
                
                <div class="profile-section">
                    <h3 class="profile-title"><i class="fas fa-tree"></i> Paisaje Sonoro</h3>
                    <p class="profile-content" id="soundscape">Un espacio personal de creatividad y autodescubrimiento</p>
                </div>
                
                <div class="profile-section bg-yellow-50">
                    <h3 class="profile-title"><i class="fas fa-quote-left"></i> Tu Frase Motivacional</h3>
                    <p class="profile-content italic" id="motivationalPhrase">Tu música interior es única e irrepetible</p>
                </div>
                
                <div class="profile-section text-center py-6">
                    <button onclick="generatePDF()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-semibold transition-all">
                        <i class="fas fa-file-pdf mr-2"></i>Descargar Mi Perfil en PDF
                    </button>
                    <button onclick="shareProfile()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold ml-4 transition-all">
                        <i class="fas fa-share mr-2"></i>Compartir Mi Perfil
                    </button>
                </div>
                
                <div class="profile-section px-6 pb-6">
                    <h3 class="text-sm font-semibold text-gray-500 mb-2">Firmado por:</h3>
                    <div class="signature-grid">
                        <div class="signature-item">Doc.</div>
                        <div class="signature-item">Desc.</div>
                        <div class="signature-item">Dec.</div>
                        <div class="signature-item">Dec.</div>
                        <div class="signature-item">App1.</div>
                        <div class="signature-item">Tú Ss.</div>
                        <div class="signature-item">Nuev.</div>
                        <div class="signature-item">Docu.</div>
                        <div class="signature-item">Iju.ps.</div>
                        <div class="signature-item">Dep.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-12 text-white opacity-75">
            <p><i class="fas fa-clock mr-2"></i>Duración: 2-3 minutos por jugador</p>
            <p><i class="fas fa-dollar-sign mr-2"></i>Costo por experiencia: $2000 COP</p>
            <p class="mt-4 text-sm">© Tu Sonido Interior - Juego Musical Terapéutico</p>
        </div>
    </div>

    <script>
        // Global game state
        let gameState = {
            color: null,
            melody: null,
            rhythm: null,
            emotion: null,
            currentStep: 1,
            currentAudio: null
        };

        // Complete profiles database
        const profilesDatabase = [
            {
                "Color": "Negro",
                "Melodía": "Weightless",
                "Ritmo": "Balada",
                "Emoción": "Suspenso",
                "Nombre del perfil": "Negro - Aire Susurro Velo",
                "Descripción": "Tu energía inicial (Negro) combinada con la melodía 'Weightless', el ritmo 'Balada' y la emoción 'Suspenso' revela un perfil de sensibilidad musical profundo. Expresas una identidad sonora que busca conexión, expresión y liberación a través del movimiento y el sonido auténtico.",
                "Instrumento sugerido": "Palo de lluvia",
                "Actividad recomendada": "Realiza una improvisación libre usando el ritmo de 'Balada' mientras canalizas la emoción de 'Suspenso' con sonidos suaves de 'Weightless'.",
                "Paisaje sonoro": "Un bosque al anochecer con ramas que crujen",
                "Frase motivacional": "La música que llevas dentro siempre encuentra una salida."
            },
            {
                "Color": "Rojo",
                "Melodía": "Synfony",
                "Ritmo": "Salsa",
                "Emoción": "Alegría",
                "Nombre del perfil": "Rojo - Esencia Ritual Brillo",
                "Descripción": "Tu energía inicial (Rojo) combinada con la melodía 'Synfony', el ritmo 'Salsa' y la emoción 'Alegría' revela un perfil de vitalidad musical explosiva. Expresas una identidad sonora llena de pasión, fuerza y celebración de la vida.",
                "Instrumento sugerido": "Maracas",
                "Actividad recomendada": "Baila libremente al ritmo de 'Salsa' mientras canalizas la alegría con la potencia de 'Synfony'.",
                "Paisaje sonoro": "Una fiesta al aire libre con luces de colores",
                "Frase motivacional": "Tu energía musical ilumina cada espacio que tocas."
            },
            {
                "Color": "Azul",
                "Melodía": "Sonidos del bosque",
                "Ritmo": "Merengue",
                "Emoción": "Tristeza",
                "Nombre del perfil": "Azul - Raíz Pulso Eco",
                "Descripción": "Tu energía inicial (Azul) combinada con la melodía 'Sonidos del bosque', el ritmo 'Merengue' y la emoción 'Tristeza' revela un perfil de profundidad emocional. Expresas una identidad sonora que encuentra belleza en la melancolía y sabiduría en el silencio.",
                "Instrumento sugerido": "Flauta de bambú",
                "Actividad recomendada": "Medita al ritmo suave del 'Merengue' mientras te conectas con los 'Sonidos del bosque' y procesas la 'Tristeza'.",
                "Paisaje sonoro": "Un lago en calma reflejando el cielo nublado",
                "Frase motivacional": "En tu silencio interior encuentras las melodías más profundas."
            },
            {
                "Color": "Verde",
                "Melodía": "Sonidos del bosque",
                "Ritmo": "Merengue",
                "Emoción": "Alegría",
                "Nombre del perfil": "Verde - Naturaleza Vibrante",
                "Descripción": "Tu energía inicial (Verde) combinada con la melodía 'Sonidos del bosque', el ritmo 'Merengue' y la emoción 'Alegría' revela un perfil lleno de vitalidad y conexión con la naturaleza. Tu música fluye como un río alegre en el bosque.",
                "Instrumento sugerido": "Pandereta",
                "Actividad recomendada": "Danza al aire libre sintiendo la conexión entre tu ritmo interior y los sonidos naturales.",
                "Paisaje sonoro": "Un claro en el bosque con pájaros cantando",
                "Frase motivacional": "Tu ritmo es el latido de la naturaleza."
            },
            {
                "Color": "Blanco",
                "Melodía": "Weightless",
                "Ritmo": "Balada",
                "Emoción": "Tristeza",
                "Nombre del perfil": "Blanco - Pureza Melancólica",
                "Descripción": "Tu energía inicial (Blanco) combinada con la melodía 'Weightless', el ritmo 'Balada' y la emoción 'Tristeza' revela un perfil de sensibilidad pura y emociones profundas. Tu música es un lienzo en blanco que captura la esencia de los sentimientos.",
                "Instrumento sugerido": "Piano",
                "Actividad recomendada": "Improvisa melodías suaves que expresen tu estado emocional actual.",
                "Paisaje sonoro": "Una habitación silenciosa con una ventana a la lluvia",
                "Frase motivacional": "En la quietud blanca, las emociones encuentran su voz."
            },
            {
                "Color": "Amarillo",
                "Melodía": "Synfony",
                "Ritmo": "Salsa",
                "Emoción": "Alegría",
                "Nombre del perfil": "Amarillo - Energía Solar",
                "Descripción": "Tu energía inicial (Amarillo) combinada con la melodía 'Synfony', el ritmo 'Salsa' y la emoción 'Alegría' revela un perfil lleno de energía positiva y creatividad radiante. Tu música es como un rayo de sol que ilumina todo a su paso.",
                "Instrumento sugerido": "Trompeta",
                "Actividad recomendada": "Crea una coreografía espontánea que combine movimiento y expresión vocal.",
                "Paisaje sonoro": "Una playa al atardecer con risas y olas",
                "Frase motivacional": "Tu alegría musical es contagiosa como la luz del sol."
            }
        ];

        // Sound URLs
        const soundUrls = {
            melody: {
                'Weightless': 'https://dl.dropboxusercontent.com/scl/fi/yci9wbuuekspmv359ha0p/1sonido1.mp3?rlkey=6wt3lbfcz2ium6h2x6n0a182r',
                'Sonidos del bosque': 'https://dl.dropboxusercontent.com/scl/fi/kgheex76eze9qwigmubvw/1sonido2.mp3?rlkey=srkisoxpituldcjfmys2bph6e',
                'Synfony': 'https://dl.dropboxusercontent.com/scl/fi/v6a7fjrl9n5ul06ia9a72/1sonido3.mp3?rlkey=cc8ajn6nx67yjv4izln6c0n39'
            },
            rhythm: {
                'Balada': 'https://dl.dropboxusercontent.com/scl/fi/qp1ybmcu8ppbtuwer8lgr/2ritmo1.mp3?rlkey=oyheem04xpitzji11rlm344w2',
                'Despecho': 'https://dl.dropboxusercontent.com/scl/fi/splu4gxo8jhr9l3pyxbx1/2ritmo2.mp3?rlkey=gdvg4bflvj7pewj3gpstcz4jk',
                'Merengue': 'https://dl.dropboxusercontent.com/scl/fi/s1x3m2ry8ihyy5q7rpu0h/2ritmo3.mp3?rlkey=5o3kv9nzmcn19k68h9nahcmlf',
                'Reguetón': 'https://dl.dropboxusercontent.com/scl/fi/d01lmkki2vhiz9lsbxgdn/2ritmo4.mp3?rlkey=ppn8le4yehtllt2wpo2xdu3n8',
                'Salsa': 'https://dl.dropboxusercontent.com/scl/fi/06t5hmvo9tmh17kcp16xs/2ritmo5.mp3?rlkey=e4v3a4mxfje2zuryym2jvnnis'
            },
            emotion: {
                'Suspenso': 'https://dl.dropboxusercontent.com/scl/fi/8ks4shizrbcj929729bu6/3emocion1.mp3?rlkey=o1ghp9sdixtio3m9ajxje6yun',
                'Tristeza': 'https://dl.dropboxusercontent.com/scl/fi/8d7rafojr6q0m4g8ap9nu/3emocion2.mp3?rlkey=i3dcbi7g3datrtoz5ir3m1xke',
                'Alegría': 'https://dl.dropboxusercontent.com/scl/fi/zp2v713m1xtspp0xls1oc/3emocion3.mp3?rlkey=o8ndag8y9rr230fsnonm7kkm1'
            }
        };

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
        });

        function initializeGame() {
            updateProgressIndicator();
            
            // Add event listeners for Jenga blocks
            document.querySelectorAll('.jenga-block').forEach(block => {
                block.addEventListener('click', function() {
                    selectColor(this.dataset.color);
                });
            });

            // Add event listeners for melody options
            document.querySelectorAll('.melody-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectMelody(this.dataset.melody);
                });
            });

            // Add event listeners for rhythm options
            document.querySelectorAll('.rhythm-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectRhythm(this.dataset.rhythm);
                });
            });

            // Add event listeners for emotion options
            document.querySelectorAll('.emotion-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectEmotion(this.dataset.emotion);
                });
            });

            // Add event listener for reveal button
            document.getElementById('revealButton').addEventListener('click', revealProfile);
        }

        function selectColor(color) {
            gameState.color = color;
            gameState.currentStep = 2;
            
            // Update UI
            document.querySelectorAll('.jenga-block').forEach(block => {
                block.classList.remove('selected');
            });
            document.querySelectorAll(`[data-color="${color}"]`).forEach(block => {
                block.classList.add('selected');
            });
            
            document.getElementById('selectedColorName').textContent = color;
            document.getElementById('colorSelected').classList.remove('hidden');
            
            // Auto-advance to step 2
            document.getElementById('melodiesSection').classList.remove('hidden');
            document.getElementById('melodiesSection').scrollIntoView({ behavior: 'smooth' });
            updateProgressIndicator();
        }

        function selectMelody(melody) {
            gameState.melody = melody;
            
            // Update UI only (no auto-advance)
            document.querySelectorAll('.melody-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-melody="${melody}"]`).classList.add('selected');
        }

        function selectRhythm(rhythm) {
            gameState.rhythm = rhythm;
            
            // Update UI only (no auto-advance)
            document.querySelectorAll('.rhythm-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-rhythm="${rhythm}"]`).classList.add('selected');
        }

        function selectEmotion(emotion) {
            gameState.emotion = emotion;
            
            // Update UI and enable reveal button
            document.querySelectorAll('.emotion-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-emotion="${emotion}"]`).classList.add('selected');
            
            document.getElementById('revealButton').disabled = false;
            document.getElementById('revealSection').classList.remove('hidden');
            document.getElementById('revealSection').scrollIntoView({ behavior: 'smooth' });
            updateProgressIndicator();
        }

        function goToStep(step) {
            gameState.currentStep = step;
            updateProgressIndicator();
            
            // Hide all sections
            document.getElementById('melodiesSection').classList.add('hidden');
            document.getElementById('rhythmsSection').classList.add('hidden');
            document.getElementById('emotionsSection').classList.add('hidden');
            
            // Show the corresponding section
            if (step === 3) {
                document.getElementById('rhythmsSection').classList.remove('hidden');
                document.getElementById('rhythmsSection').scrollIntoView({ behavior: 'smooth' });
            } else if (step === 4) {
                document.getElementById('emotionsSection').classList.remove('hidden');
                document.getElementById('emotionsSection').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function updateProgressIndicator() {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (i < gameState.currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (i === gameState.currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            }
        }

        function playSound(type, option, buttonElement) {
            // Stop any currently playing audio
            if (gameState.currentAudio) {
                gameState.currentAudio.pause();
                gameState.currentAudio = null;
                resetAllAudioButtons();
            }

            const url = soundUrls[type][option];
            if (!url) {
                console.warn('No se encontró la URL del sonido:', type, option);
                return;
            }

            // Find the parent option card
            const optionCard = buttonElement.closest(`.${type}-option`);
            
            // Hide play button and show stop button
            const playButton = optionCard.querySelector(`.${type}-play`);
            const stopButton = optionCard.querySelector(`.${type}-stop`);
            playButton.classList.add('hidden');
            stopButton.classList.remove('hidden');

            // Opacar todas las opciones de este tipo
            document.querySelectorAll(`.${type}-option`).forEach(el => {
                el.style.opacity = '0.6';
                el.style.transition = 'opacity 0.3s ease';
            });

            // Resaltar la opción seleccionada
            optionCard.style.opacity = '1';
            optionCard.classList.add('pulse');

            const audio = new Audio(url);
            audio.volume = 0.8;
            gameState.currentAudio = audio;
            
            audio.addEventListener('ended', () => {
                // Restaurar cuando termina la reproducción
                resetAudioButtons(type, option);
                document.querySelectorAll(`.${type}-option`).forEach(el => {
                    el.style.opacity = '1';
                    el.classList.remove('pulse');
                });
            });
            
            audio.play().catch(err => {
                console.error('Error al reproducir el audio:', err);
                resetAudioButtons(type, option);
                document.querySelectorAll(`.${type}-option`).forEach(el => {
                    el.style.opacity = '1';
                    el.classList.remove('pulse');
                });
            });
        }

        function stopSound(type, option, buttonElement) {
            if (gameState.currentAudio) {
                gameState.currentAudio.pause();
                gameState.currentAudio = null;
                resetAudioButtons(type, option);
                
                // Find the parent option card
                const optionCard = buttonElement.closest(`.${type}-option`);
                optionCard.style.opacity = '1';
                optionCard.classList.remove('pulse');
                
                // Restore all options opacity
                document.querySelectorAll(`.${type}-option`).forEach(el => {
                    el.style.opacity = '1';
                    el.classList.remove('pulse');
                });
            }
        }

        function resetAudioButtons(type, option) {
            const optionCard = document.querySelector(`[data-${type}="${option}"]`);
            if (optionCard) {
                const playButton = optionCard.querySelector(`.${type}-play`);
                const stopButton = optionCard.querySelector(`.${type}-stop`);
                if (playButton && stopButton) {
                    playButton.classList.remove('hidden');
                    stopButton.classList.add('hidden');
                }
            }
        }

        function resetAllAudioButtons() {
            document.querySelectorAll('.melody-play, .rhythm-play, .emotion-play').forEach(btn => {
                btn.classList.remove('hidden');
            });
            document.querySelectorAll('.melody-stop, .rhythm-stop, .emotion-stop').forEach(btn => {
                btn.classList.add('hidden');
            });
        }

        function revealProfile() {
            const profile = findProfile(gameState.color, gameState.melody, gameState.rhythm, gameState.emotion);
            
            if (profile) {
                displayProfile(profile);
            } else {
                // Generate a default profile if not found in database
                displayDefaultProfile();
            }
            
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function findProfile(color, melody, rhythm, emotion) {
            return profilesDatabase.find(p => 
                p.Color === color && 
                p["Melodía"] === melody && 
                p.Ritmo === rhythm && 
                p.Emoción === emotion
            );
        }

        function displayProfile(profile) {
            document.getElementById('profileName').textContent = profile["Nombre del perfil"];
            document.getElementById('profileDescription').textContent = profile.Descripción;
            document.getElementById('suggestedInstrument').textContent = profile["Instrumento sugerido"];
            document.getElementById('recommendedActivity').textContent = profile["Actividad recomendada"];
            document.getElementById('soundscape').textContent = profile["Paisaje sonoro"];
            document.getElementById('motivationalPhrase').textContent = profile["Frase motivacional"];
            
            // Update the combination tags
            const tagsContainer = document.querySelector('.profile-header div');
            tagsContainer.innerHTML = '';
            
            const colorTag = document.createElement('span');
            colorTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            colorTag.textContent = profile.Color;
            tagsContainer.appendChild(colorTag);
            
            const melodyTag = document.createElement('span');
            melodyTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            melodyTag.textContent = profile["Melodía"];
            tagsContainer.appendChild(melodyTag);
            
            const rhythmTag = document.createElement('span');
            rhythmTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            rhythmTag.textContent = profile.Ritmo;
            tagsContainer.appendChild(rhythmTag);
            
            const emotionTag = document.createElement('span');
            emotionTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            emotionTag.textContent = profile.Emoción;
            tagsContainer.appendChild(emotionTag);
            
            // Set header color based on selected color
            const header = document.querySelector('.profile-header');
            switch(profile.Color.toLowerCase()) {
                case 'negro':
                    header.style.background = 'linear-gradient(135deg, #000000 0%, #333333 100%)';
                    break;
                case 'rojo':
                    header.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                    break;
                case 'azul':
                    header.style.background = 'linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%)';
                    break;
                case 'verde':
                    header.style.background = 'linear-gradient(135deg, #16a34a 0%, #15803d 100%)';
                    break;
                case 'blanco':
                    header.style.background = 'linear-gradient(135deg, #ffffff 0%, #e5e7eb 100%)';
                    header.style.color = '#000';
                    break;
                case 'amarillo':
                default:
                    header.style.background = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
            }
        }

        function displayDefaultProfile() {
            const defaultProfile = {
                name: `${gameState.color} - Perfil Único`,
                description: `Tu combinación única de ${gameState.color}, ${gameState.melody}, ${gameState.rhythm} y ${gameState.emotion} revela una personalidad musical especial y auténtica.`,
                instrument: "Instrumento de percusión",
                activity: "Explora diferentes ritmos y melodías para encontrar tu expresión personal",
                soundscape: "Un espacio personal de creatividad y autodescubrimiento",
                phrase: "Tu música interior es única e irrepetible"
            };
            
            document.getElementById('profileName').textContent = defaultProfile.name;
            document.getElementById('profileDescription').textContent = defaultProfile.description;
            document.getElementById('suggestedInstrument').textContent = defaultProfile.instrument;
            document.getElementById('recommendedActivity').textContent = defaultProfile.activity;
            document.getElementById('soundscape').textContent = defaultProfile.soundscape;
            document.getElementById('motivationalPhrase').textContent = defaultProfile.phrase;
            
            // Update the combination tags
            const tagsContainer = document.querySelector('.profile-header div');
            tagsContainer.innerHTML = '';
            
            const colorTag = document.createElement('span');
            colorTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            colorTag.textContent = gameState.color;
            tagsContainer.appendChild(colorTag);
            
            const melodyTag = document.createElement('span');
            melodyTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            melodyTag.textContent = gameState.melody;
            tagsContainer.appendChild(melodyTag);
            
            const rhythmTag = document.createElement('span');
            rhythmTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            rhythmTag.textContent = gameState.rhythm;
            tagsContainer.appendChild(rhythmTag);
            
            const emotionTag = document.createElement('span');
            emotionTag.className = 'bg-white bg-opacity-20 px-3 py-1 rounded-full';
            emotionTag.textContent = gameState.emotion;
            tagsContainer.appendChild(emotionTag);
            
            // Set header color based on selected color
            const header = document.querySelector('.profile-header');
            switch(gameState.color.toLowerCase()) {
                case 'negro':
                    header.style.background = 'linear-gradient(135deg, #000000 0%, #333333 100%)';
                    break;
                case 'rojo':
                    header.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                    break;
                case 'azul':
                    header.style.background = 'linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%)';
                    break;
                case 'verde':
                    header.style.background = 'linear-gradient(135deg, #16a34a 0%, #15803d 100%)';
                    break;
                case 'blanco':
                    header.style.background = 'linear-gradient(135deg, #ffffff 0%, #e5e7eb 100%)';
                    header.style.color = '#000';
                    break;
                case 'amarillo':
                default:
                    header.style.background = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
            }
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set colors based on selected color
            let primaryColor, secondaryColor;
            switch(gameState.color.toLowerCase()) {
                case 'negro':
                    primaryColor = '#000000';
                    secondaryColor = '#333333';
                    break;
                case 'rojo':
                    primaryColor = '#dc2626';
                    secondaryColor = '#b91c1c';
                    break;
                case 'azul':
                    primaryColor = '#1e40af';
                    secondaryColor = '#1e3a8a';
                    break;
                case 'verde':
                    primaryColor = '#16a34a';
                    secondaryColor = '#15803d';
                    break;
                case 'blanco':
                    primaryColor = '#ffffff';
                    secondaryColor = '#e5e7eb';
                    break;
                case 'amarillo':
                default:
                    primaryColor = '#fbbf24';
                    secondaryColor = '#f59e0b';
            }
            
            // Add header with gradient
            doc.setFillColor(primaryColor);
            doc.rect(0, 0, 210, 30, 'F');
            
            // Add title
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.text('Tu Sonido Interior', 105, 20, { align: 'center' });
            
            // Add profile name
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text(document.getElementById('profileName').textContent, 105, 40, { align: 'center' });
            
            // Add combination tags
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.text(`${gameState.color} • ${gameState.melody} • ${gameState.rhythm} • ${gameState.emotion}`, 105, 50, { align: 'center' });
            
            // Add content sections
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            
            // Description
            doc.text('Descripción de tu Perfil:', 20, 70);
            doc.setFontSize(12);
            const descLines = doc.splitTextToSize(document.getElementById('profileDescription').textContent, 170);
            doc.text(descLines, 20, 80);
            
            // Instrument
            doc.setFontSize(14);
            doc.text('Instrumento Sugerido:', 20, 110);
            doc.setFontSize(12);
            doc.text(document.getElementById('suggestedInstrument').textContent, 30, 120);
            
            // Activity
            doc.setFontSize(14);
            doc.text('Actividad Recomendada:', 20, 140);
            doc.setFontSize(12);
            const actLines = doc.splitTextToSize(document.getElementById('recommendedActivity').textContent, 170);
            doc.text(actLines, 20, 150);
            
            // Soundscape
            doc.setFontSize(14);
            doc.text('Paisaje Sonoro:', 20, 180);
            doc.setFontSize(12);
            doc.text(document.getElementById('soundscape').textContent, 30, 190);
            
            // Motivational phrase
            doc.setFontSize(14);
            doc.text('Tu Frase Motivacional:', 20, 210);
            doc.setFontSize(12);
            const phraseLines = doc.splitTextToSize(document.getElementById('motivationalPhrase').textContent, 170);
            doc.text(phraseLines, 20, 220);
            
            // Add signatures
            doc.setFontSize(10);
            doc.text('Firmado por:', 20, 250);
            const signatures = ['Doc.', 'Desc.', 'Dec.', 'Dec.', 'App1.', 'Tú Ss.', 'Nuev.', 'Docu.', 'Iju.ps.', 'Dep.'];
            for (let i = 0; i < signatures.length; i++) {
                const x = 20 + (i % 5) * 38;
                const y = 260 + Math.floor(i / 5) * 10;
                doc.text(signatures[i], x, y);
            }
            
            // Save the PDF
            doc.save(`tu-sonido-interior-${gameState.color.toLowerCase()}.pdf`);
        }

        function shareProfile() {
            const profileName = document.getElementById('profileName').textContent;
            const text = `¡Descubrí mi perfil musical en "Tu Sonido Interior"! 
            
${profileName}

Mi combinación: ${gameState.color} + ${gameState.melody} + ${gameState.rhythm} + ${gameState.emotion}

${document.getElementById('motivationalPhrase').textContent}

¡Descubre el tuyo también! #TuSonidoInterior #PerfilMusical`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Tu Sonido Interior - Mi Perfil Musical',
                    text: text
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(text).then(() => {
                    alert('¡Perfil copiado al portapapeles! Puedes compartirlo en tus redes sociales.');
                });
            }
        }

        // Add some extra interactivity
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('jenga-block')) {
                // Add click sound effect
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }
        });
    </script>
</body>
</html>
